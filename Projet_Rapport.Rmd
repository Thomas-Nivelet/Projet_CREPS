---
title: "Projet CREPS"
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    toc: yes
  pdf_document:
    fig_height: 4
    fig_width: 5.5
    number_sections: yes
    toc: yes
subtitle: "Mise en place d'un modèle statistique pour validaton du testing TM2S"
header-includes:
- \usepackage{authblk}
- \usepackage[french]{babel}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \renewcommand\headrulewidth{1pt}
- \fancyhead[L]{\scshape \leftmark}
- \fancyhead[R]{\bfseries Projet tutoré}
- \fancyfoot[L]{INSA Toulouse}
- \author{\bfseries Célia DULUC, Thomas NIVELET, Alexia GHOZLAND}
- \affil{4\textsuperscript{e} année MA}
- \affil{INSA Toulouse}
- \affil{\small Année universitaire 2020-2021}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#inlude = FALSE : ni le code, ni la sortie apparaît dans le pdf
#echo=FALSE: le code n'apparaît pas mais les sorties oui
#eval=FALSE: le code n'est pas runné
#results="hide": le code est visible mais pas les sorties
```

# Introduction


# Statistiques descriptives

**Importation des librairies `R` nécessaires**

```{r, include=FALSE}
library(readxl)
library(ggplot2)
library(ggmosaic)
library(MASS)
library(dplyr)
library(fmsb)
library(corrplot)
```

**Importation des données** 

```{r, include=FALSE}
# Importation du fichier de données depuis un .xlsx
donnees_creps <- read_excel("Donnees_CREPS_1.xlsx")
```

## Première prise en main des données
### Statistiques unidimensionnelles : étude générale des pôles et des scores obtenus

```{r, include=FALSE}
# Redéfinition de la variable qualitative à bon escient (en facteurs)
donnees_creps$POLES <- as.factor(donnees_creps$POLES)

# Vérification du contenu et présentation sommaire des variables
summary(donnees_creps)
head(donnees_creps)
```


```{r, include=FALSE}
# Observations et variables contenues dans le jeu de données
dim(donnees_creps)
```

Le premier jeu de données à notre disposition contient les scores obtenus au testing TM2S, relatif à la mobilité et à la stabilité su sportif, de 90 athlètes du CREPS, répartis dans 6 pôles sportifs différents : 
- Aviron (`AV`), 
- Baseball (`BS`),
- Boxe française (`BF`), 
- Basketball (`BK`), 
- Bowling (`BL`), 
- Natation (`NAT`), 
- Natation synchronisée (`NS`), 
- Rugby à XIII (`R`),
Plusieurs des variables présentes dans ce premier jeu de données attireront particulièrement notre attention dans la suite du projet :

- `SCORE`, une variable quantitative discrète, prenant des valeurs de 0 à 20, représentant le score global obtenu par le sportif au test.
- `POLES`, une variable qualitative à 6 modalités représentant les pôles du CREPS sur lesquels a été expérimenté le TM2S.
- `MOBINF`, une variable quantitative discrète, représentant le score obtenu en mobilité inférieure.
- `MOBSUP`, une variable quantitative discrète, représentant le score obtenu en mobilité supérieure.
- `STABINF`, une variable quantitative discrète, représentant le score obtenu en stabilité inférieure.
- `STABSUP`, une variable quantitative discrète, représentant le score obtenu en stabilité supérieure.
- Vingt autre variables binaires, correspondant à la réussite (1) ou l'échec (0) à chacun des exercices du test.

```{r, echo=FALSE}
pie(table(donnees_creps$POLES), col = c("lightskyblue2", "lightgoldenrod3", "mistyrose4", "lightcoral", "mediumblue", "lightseagreen", "darkorange2", "brown4"),main = "Répartition des athlètes dans les pôles")

barplot(table(factor(donnees_creps$SCORE, levels = 0:20)), main = "Scores obtenus - Tous pôles confondus", ylim = c(0,20), cex.names = 0.6, ylab = "Effectifs", xlab= "Score", col = heat.colors(20))
```

- Répartition des athlètes dans les pôles : 
Le diagramme circulaire ci-dessus nous permet d'affirmer que les sportifs testés proviennent de huit pôles différents. Mise à part en Basketball puis en Baseball où les effectifs sont les plus élevés, les pôles présentent des effectifs assez comparables.
Viennent ensuite, de façon décroissante, la Natation Synchronisée, la Boxe Française, l'Aviron et la Natation. C'est en bowling qu'il y a le moins d'athlètes.

- Scores globaux obtenus :
On constate que les notes sont très échelonnées de 0 à 19 et prennent quasiment la totalité des valeurs possibles. Le score le plus obtenu au test est la note de 9, soit proche de la moyenne. L'allure globale du bar plot fait furieusement penser à une courbe gaussienne, avec donc un certain étalement sur 20 valeurs ainsi qu'une légère symétrie.
Cependant, on dénote davantage de notes inférieures à la moyenne que de notes supérieures à 10/20.
13 athlètes ont reçu un score de 8, autant que pour un score de 9. Des pics plus discrets s'affichent pour les scores de 12, 5 (et 14). 
Très peu d'athlètes obtiennent des notes au moins égales à 13.
Notre premières impression est telle que l'on imagine ce testing assez compliqué dans l'absolu ; mais il va nous falloir étudier plus en détails cette notation, par pôles et par catégories d'exercices.

### Statistiques bidimensionnelles : distinction des scores obtenus selon les pôles
#### Étude de la spécificité de chaque pôle

Dans cette partie, nous cherchons à analyser les scores ou intervalles de score les plus obtenus et offrir une comparaison selon les pôles. On essaiera de déterminer une certaine variabilité des profils et de mettre en perspective ces résultats selon les pôles.

```{r, echo=FALSE}
SCORE <- donnees_creps$SCORE
POLES <- donnees_creps$POLES

#tab_mean <- tapply(SCORE, POLES, mean) # Moyenne des scores pour chaque pôle
#tab_median <- tapply(SCORE, POLES, median) # Médiane des scores pour chaque pôle
#tab_mean
#tab_median
```

```{r, echo=FALSE}
boxplot(SCORE ~ POLES, cex.axis = 0.8, main = "Boxplots parallèles des scores en fonction des pôles", xlab = "Pôles", ylab = "Score")
```

Les boxplots (ou diagrammes en boîtes) ci-dessus nous permettent d'évaluer la position, l'éventuelle symétrie, ainsi que la dispersion des scores obtenus pour chaque pôle. Sur ces graphiques, 50% des observations sont rassemblées à l'intérieur d'une boîte grisée, le trait plein noir représentant la médiane.

Les médianes sont alignées au score de 9/20 pour les boxplots concernant les athlètes de Bowling, Basketball, Aviron et Baseball : il y a autant de scores obtenus en-dessous qu'au dessus de cette note, pour ces pôles-ci.
En aviron, on observe un faible écart inter-quartiles, les scores ne sont pas trop dispersés au sein de ce pôle, le niveau est donc homogène. (mais 2 outliers).
En Natation Synchronisée, la médiane s'élève à 11/20, la plus élevée parmi tous les pôles. De plus, l'écart interquartile n'est pas très haut. On peut en déduire un niveau homogène et bon, en majorité situé au-dessus de la moyenne de 10/20.
Les scores des joueurs de rugby à XIII sont très resserrés et proches de la médiane, située à 7. Les résultats globaux de ce pôle apparaissent comme les plus faibles, tous pôles confondus.
En conclusion, les scores médians sont plutôt proches mais les scores selon les pôles sont plus dispersés (BF par rapport à AV par exemple).
L'ensemble de ces analyses doit être mise en relief avec l'effectif d'athlètes pour chaque pôle considéré ; en effet, on dispose de moins d'athlètes pour l'aviron que pour le basketball par exemple.

```{r, echo=FALSE}
par(mfrow=c(2,2))
plot(donnees_creps$MOBINF ~donnees_creps$POLES, ylab="Score en mobilité inf", xlab="Poles", cex.axis = 0.85)
plot(donnees_creps$MOBSUP ~donnees_creps$POLES, ylab="Score en mobilité sup", xlab="Poles", cex.axis = 0.85)
plot(donnees_creps$STABINF ~donnees_creps$POLES, ylab="Score en stabilité inf", xlab="Poles", cex.axis = 0.85)
plot(donnees_creps$STABSUP ~donnees_creps$POLES,ylab="Score en stabilité sup", xlab="Poles", cex.axis = 0.85)
```

- Pour la mobilité inférieure (note sur 8) : le score médian de tous les pôles se situe aux alentours de 3, i.e 50% des athlètes de ces pôles ont un score inférieur à 3. Le pôle Natation Synchronisée se détache avec une médiane très proche de 6, et une certaine homogénéité des athlètes (faible écart interquartile). (Les nageuses sont plus souples : sont-elles moins blessées à ce niveau-la pour autant ?). Le pôle du Rugby à XIII se détache quant à lui par ses la faiblesse de ses résultats ; on peut ici faire le lien avec leur gabarit, ainsi que le fait qu'ils pratiquent un sport de contact.
- Pour la mobilité supérieure (note sur 4) : Les pôles Boxe et Bowling sont les plus faibles avec une médiane de 1. On peut également remarquer qu'un grand nombre d'athlètes ont un score approximatif de 1, car la médiane semble assimilable au premier quartile. Ces deux pôles semblent avoir un comportement similaire, même dispersion (cf ont-ils le même type de blessure?).Pour l'Aviron et le Basket, il est plus difficile de conclure, la dispersion est importante, les athlètes non homogènes? Plus grande homogénéité pour la Natation et la Natation Synchronisée, avec une médiane plus haute. A nouveau, les plus mauvais résultats dans cette catégorie sont obtenus par les joueurs de rugby à XIII.
- Pour la stabilité inférieure (note sur 6) : Encore une fois, on constate une certaine disparité entre les pôles. Les médianes les plus faibles (autour de 2) pour la boxe, la natation et la Natation Synchronisée. Il y a une dispersion plus important pour les trois autres pôles mais ils obtiennent globalement de meilleurs scores.
- Pour la stabilité supérieure (note sur 2) : 75% des athlètes ont une note inférieure ou égale à 1 pour le basket, la boxe et le bowling. 75% des athlètes ont une note supérieure ou égale à 1 pour l'aviron et la natation. La répartition est symétrique par rapport au score 1 pour la Natation Synchronisée.

Représentons les scores moyens obtenus pour chaque pôle dans les quatre catégories d'exercices sous la forme d'un radarplot :

```{r,fig.height = 9, fig.width = 13}

# Test graphes araignée superposés
## Récupération des données moyennes, minimales et maximales

Mob_inf = c(8,0,mean(donnees_creps$MOBINF[POLES=="AV"]),mean(donnees_creps$MOBINF[POLES=="BF"]),mean(donnees_creps$MOBINF[POLES=="BK"]),mean(donnees_creps$MOBINF[POLES=="BL"]),mean(donnees_creps$MOBINF[POLES=="BS"]),mean(donnees_creps$MOBINF[POLES=="NAT"]),mean(donnees_creps$MOBINF[POLES=="NS"]),mean(donnees_creps$MOBINF[POLES=="R"]))

Mob_sup = c(4,0,mean(donnees_creps$MOBSUP[POLES=="AV"]),mean(donnees_creps$MOBSUP[POLES=="BF"]),mean(donnees_creps$MOBSUP[POLES=="BK"]),mean(donnees_creps$MOBSUP[POLES=="BL"]),mean(donnees_creps$MOBSUP[POLES=="BS"]),mean(donnees_creps$MOBSUP[POLES=="NAT"]),mean(donnees_creps$MOBSUP[POLES=="NS"]),mean(donnees_creps$MOBSUP[POLES=="R"]))

Stab_inf = c(6,0,mean(donnees_creps$STABINF[POLES=="AV"]),mean(donnees_creps$STABINF[POLES=="BF"]),mean(donnees_creps$STABINF[POLES=="BK"]),mean(donnees_creps$STABINF[POLES=="BL"]),mean(donnees_creps$STABINF[POLES=="BS"]),mean(donnees_creps$STABINF[POLES=="NAT"]),mean(donnees_creps$STABINF[POLES=="NS"]),mean(donnees_creps$STABINF[POLES=="R"]))

Stab_sup = c(2,0,mean(donnees_creps$STABSUP[POLES=="AV"]),mean(donnees_creps$STABSUP[POLES=="BF"]),mean(donnees_creps$STABSUP[POLES=="BK"]),mean(donnees_creps$STABSUP[POLES=="BL"]),mean(donnees_creps$STABSUP[POLES=="BS"]),mean(donnees_creps$STABSUP[POLES=="NAT"]),mean(donnees_creps$STABSUP[POLES=="NS"]),mean(donnees_creps$STABSUP[POLES=="R"]))

data_spider <- cbind(Mob_inf,Mob_sup,Stab_inf,Stab_sup)

rownames(data_spider) <- c("MAX", "MIN", "AV", "BF", "BK", "BL", "BS", "NAT", "NS", "R")

colnames(data_spider) <- c("Mob. inf.", "Mob. sup.", "Stab. inf.", "Stab. sup.")

data_spider = as.data.frame(data_spider)

## Définition et affichage du radarchart
par(mar = c(1, 1, 1, 1))
radarchart(data_spider, axistype = 1,pcol = c("lightskyblue2", "lightgoldenrod3", "mistyrose4", "lightcoral", "mediumblue", "lightseagreen",  "darkorange2", "brown4"),plwd = 2, plty = 1,cglcol = "grey", cglty = 1, cglwd = 0.4, axislabcol = "grey",vlcex = 0.7, vlabels = colnames(data_spider),caxislabels = NULL, title = "Scores moyens par catégrories d'exercices")

legend(x = "right", legend = rownames(data_spider[-c(1,2),]), horiz = FALSE,bty = "n", pch = 20 , col = c("lightskyblue2", "lightgoldenrod3", "mistyrose4", "lightcoral", "mediumblue", "lightseagreen", "darkorange2", "brown4"),text.col = "black", cex = 1, pt.cex = 1.5)
```
On peut clairement distinguer que les athlètes de Natation Synchronisée se démarquent sur la mobilité inférieure, ce qui peut s'expliquer par la souplesse requise et améliorée dans ce sport. Tandis que, les athlètes de la Natation, eux, se démarquent en stabilité supérieure ( les membres supérieurs sont plus sollicités pour nager ). 
En Stabilité Inférieure, ce sont les athlètes de l'Aviron qui tirent leur épingle du jeu (ils obtiennent près de 75% des points). Moins élevés que les nageurs artistiques mais ils obtiennent + de 50% des points en Stabilité Supérieure ce qui paraît logique au vu des mouvements nécessaires à ce sport.
En boxe française, les scores par catégories d'exercices sont plutôt homogènes, les athlètes obtiennent autour de 50% des points dans chacune des catégories.
Au Basket Ball, les athlètes sont assez bons sur les exercices de mobilité supérieure  et stabilité inférieure puisqu'ils obtiennent près de 50% des points dans chacune des ces 2 catégories tandis que sur les autres, ils sont plutôt autour de 25%.
Les joueurs de Bowling eux, sont assez bons sur la stabilité inférieure (50% des points) alors qu'ils sont à 40% du total sur les autres catégories. 
Enfin, les joueurs de rugby à XIII présentent les moins bons résultats tous pôles confondus en mobilité, tandis qu'il sont dans le tiers supérieur en stabilité inférieure, et dans la moyenne en stabilité supérieure.
les joueurs de baseball ont des résultats globalement dans la moyenne en mobilité, et sont même dans les meilleurs en stabilité.

```{r, results="hide"}
# Construction d'un modèle linéaire : tests de modèle d'ANOVA
#Pas notre sujet? Pas forcément utile?!
ao.score.pole = lm(SCORE ~ POLES, data = donnees_creps)
summary(ao.score.pole)
```

On peut voir que le modèle d'ANOVA testé ici (la variable POLES pour expliquer le score) n'ajuste pas bien les données, car le $R^2$ est faible (proche de 0). Donc l'appartenance à un pôle ne suffit pas à expliquer le score obtenu au test. Pour mieux expliquer le score, il nous faudra donc "complexifier" le modèle", en considérant par exemple d'autres variables.


# Validation du protocole 

##Corrélations entre exercices

```{r}
summary(donnees_creps)
head(donnees_creps)
```

```{r}
exos_quant=donnees_creps[,8:27]
E<-cor(exos_quant)
corrplot(E,method="number",number.cex=0.5)
corrplot(E,method="ellipse",number.cex=0.5)

```
Le corrélogramme montre que les exercices/positions ne sont pas vraiment lié(e)s entre eux/elles. On peut conclure qu'il n'y a pas de redondance et ainsi que chaque position a son "utilité". En effet, seules les positions D/G sont corrélées, mais ceci paraît logique. Hamstring Stretch D et G sont les plus liées avant Hamstring Curl D/G. Pigeon posé D/G et Arm Clock D/G ont aussi des coefficients de corrélations assez élevés relativement aux autres exercices. On peut également dire que Adductor Stretch est plutôt lié à Hamstring stretch.
(A MODIFIER JE L'AI PAS ENCORE FAIT)

Cette étape fait partie des arguments en faveur de la validation du test. 

## Analyse par exercice : Tests de Student de moyenne (moyenne=0, moyenne=1)

```{r}
#AdductorStretch

mean(donnees_creps$AdductorStretch)

res <- t.test(donnees_creps$AdductorStretch, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$AdductorStretch, mu=1, alternative="less")
res1$p.value

#pertinent de faire un test de student pour une variable aléatoire qui suit une loi de Bernoulli? (moyenne = p = proba que X=1) = résultat d'une expérience à deux issues (loi discrète)
#ou plutôt faire un test sur la valeur de la proportion (page 62 poly stat inférentielles 3A-S2?)
#Rq page 63, test de proprtion si n est petit, quand n est grand, on applique le TCL et on fait un test de niveau asymptotique  alpha.
#donc test de student est ici un test asymptotique d'égalité de la moyenne?

# x correspond à la moyenne observée 
# mu correspond à la moyenne théorique

#x=mean(donnees_creps$nom_exo)
 # Affichage de la p-value
#res$parameter # Affichage du dégré de liberté
#res$statistic # Affichage  de la statistique t
```
```{r}
#HamstringStretchG

mean(donnees_creps$HamstringStretchG)

res <- t.test(donnees_creps$HamstringStretchG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HamstringStretchG, mu=1, alternative="less")
res1$p.value
```


```{r}
#HamstringStretchD

mean(donnees_creps$HamstringStretchD)

res <- t.test(donnees_creps$HamstringStretchD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HamstringStretchD, mu=1, alternative="less")
res1$p.value
```

```{r}
#QuadStretchG

mean(donnees_creps$QuadStretchG)

res <- t.test(donnees_creps$QuadStretchG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$QuadStretchG, mu=1, alternative="less")
res1$p.value
```

```{r}
#QuadStretchD

mean(donnees_creps$QuadStretchD)

res <- t.test(donnees_creps$QuadStretchD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$QuadStretchD, mu=1, alternative="less")
res1$p.value
```

```{r}
#PigeonPoseG

mean(donnees_creps$PigeonPoseG)

res <- t.test(donnees_creps$PigeonPoseG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$PigeonPoseG, mu=1, alternative="less")
res1$p.value
```

```{r}
#PigeonPoseD

mean(donnees_creps$PigeonPoseD)

res <- t.test(donnees_creps$PigeonPoseD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$PigeonPoseD, mu=1, alternative="less")
res1$p.value
```

```{r}
#Chandelier

mean(donnees_creps$Chandelier)

res <- t.test(donnees_creps$Chandelier, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$Chandelier, mu=1, alternative="less")
res1$p.value
```

```{r}
#ArmClockG

mean(donnees_creps$ArmClockG)

res <- t.test(donnees_creps$ArmClockG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$ArmClockG, mu=1, alternative="less")
res1$p.value
```

```{r}
#ArmClockD

mean(donnees_creps$ArmClockD)

res <- t.test(donnees_creps$ArmClockD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$ArmClockD, mu=1, alternative="less")
res1$p.value
```

```{r}
#ReverseTable

mean(donnees_creps$ReverseTable)

res <- t.test(donnees_creps$ReverseTable, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$ReverseTable, mu=1, alternative="less")
res1$p.value
```

```{r}
#OverheadSquat

mean(donnees_creps$OverheadSquat)

res <- t.test(donnees_creps$OverheadSquat, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$OverheadSquat, mu=1, alternative="less")
res1$p.value
```

```{r}
#HurdleStepG

mean(donnees_creps$HurdleStepG)

res <- t.test(donnees_creps$HurdleStepG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HurdleStepG, mu=1, alternative="less")
res1$p.value
```

```{r}
#HurdleStepD

mean(donnees_creps$HurdleStepD)

res <- t.test(donnees_creps$HurdleStepD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HurdleStepD, mu=1, alternative="less")
res1$p.value
```

```{r}
#HamstringCurlG

mean(donnees_creps$HamstringCurlG)

res <- t.test(donnees_creps$HamstringCurlG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HamstringCurlG, mu=1, alternative="less")
res1$p.value
```

```{r}
#HamstringCurlD

mean(donnees_creps$HamstringCurlD)

res <- t.test(donnees_creps$HamstringCurlD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$HamstringCurlD, mu=1, alternative="less")
res1$p.value
```

```{r}
#CopenhagenPlankG

mean(donnees_creps$CopenhagenPlankG)

res <- t.test(donnees_creps$CopenhagenPlankG, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$CopenhagenPlankG, mu=1, alternative="less")
res1$p.value
```

```{r}
#CopenhagenD

mean(donnees_creps$CopenhagenD)

res <- t.test(donnees_creps$CopenhagenD, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$CopenhagenD, mu=1, alternative="less")
res1$p.value
```

```{r}
#PushUp

mean(donnees_creps$PushUp)

res <- t.test(donnees_creps$PushUp, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$PushUp, mu=1, alternative="less")
res1$p.value
```

```{r}
#CoreActivation

mean(donnees_creps$CoreActivation)

res <- t.test(donnees_creps$CoreActivation, mu=0, alternative="greater")
res$p.value

res1 <- t.test(donnees_creps$CoreActivation, mu=1, alternative="less")
res1$p.value

#tester si moyenne très petite est-ce que p-valeur significative? combien il faut de moyenne pour qu'elle le soit avec notre échantillon??? même 0,2 considéré comme signifcativement différent de 0!
```

Toutes ces p-valeurs des différents tests de Student sont très faibles. Ainsi, on peut fortement rejeter les hypothèses d'une moyenne de chacun des exercices égale à 0 ou à 1.
On peut ainsi en conclure que chaque exercice semble avoir son utilité, en permettant de différencier les différents individus. En effet, une moyenne nulle ou à l'inverse égale à 1 aurait "classé"" tous les individus d'un même côté et n'aurait pas permis d'apporter une quelconque information quant à la possibilité de blessure d'un athlète comparé à un autre.
Cela apporte un nouvel argument en faveur de la validation du protocole de test TM2S.

# Analyse test/blessure (certaines zones touchées)
##quel type de blessure selon les pôles?
## quelle indisponibilité moyenne?
## quelle fréquence?


